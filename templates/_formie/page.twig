{% set attributes = {
    id: "#{form.formId}-p-#{page.id}",
    class: [
        'fui-page',
        form.hasMultiplePages and form.settings.submitMethod == 'ajax' and page != form.getCurrentPage() ? 'fui-hidden',
    ],
    data: {
        index: page.sortOrder,
        id: page.id,
    },
} %}

<div {{ attr(attributes) }}>
    {% set html %}
        {% hook 'formie.page.start' %}

        {% set displayCurrentPageTitle = form.settings.displayCurrentPageTitle %}

        {% if displayCurrentPageTitle %}
            <legend class="fui-page-title">{{ page.name | t }}</legend>
        {% endif %}

        {% for row in page.rows %}
            {% set columnClass = "w-full px-3 mb-6 md:mb-0" %}

            {% set visibleFields = row.fields|length %}
            {% if visibleFields|length > 1 %}
                {% set columnClass = columnClass ~ " md:w-1/" ~ visibleFields|length ~ " lg:w-1/" ~ visibleFields|length ~ " xl:w-1/" ~ visibleFields|length %}
            {% else %}
                {% set columnClass = columnClass ~ " md:w-full lg:w-full xl:w-full" %}
            {% endif %}
            <div class="{{ (visibleFields | length) ? 'flex flex-wrap -mx-3 mb-6' : 'flex' }}">
                {% for field in row.fields %}
                <div class="{{columnClass }}">
                        {{ craft.formie.renderField(form, field, options) }}
                </div>
                {% endfor %}
            </div>
        {% endfor %}

        {% hook 'formie.page.end' %}
    {% endset %}

    {{ tag(displayCurrentPageTitle ? 'fieldset' : 'div', {
        class: [
            'fui-page-container',
            displayCurrentPageTitle ? 'fui-fieldset',
        ],
        html: html,
    }) }}

    {% if submission is defined %}
        {% set flashNotice = craft.formie.plugin.service.getFlash(form.id, 'notice') %}
        {% set flashError = craft.formie.plugin.service.getFlash(form.id, 'error') %}

        {% if flashNotice and form.settings.submitActionMessagePosition == 'bottom-form' %}
            <div class="fui-alert fui-alert-success fui-alert-{{ form.settings.submitActionMessagePosition }}" role="alert">
                {{ flashNotice | t | raw }}
            </div>
        {% endif %}

        {% if flashError and form.settings.errorMessagePosition == 'bottom-form' %}
            <div class="fui-alert fui-alert-error fui-alert-{{ form.settings.errorMessagePosition }}" role="alert">
                {{ flashError | t | raw }}
            </div>
        {% endif %}
    {% endif %}

    {{ formieInclude('_includes/submit') }}
</div>
